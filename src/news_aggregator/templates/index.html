<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsletter Monitor</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1>Newsletter Monitor</h1>
                    <p class="lead">Generate AI-powered newsletters on any topic</p>
                </div>
                <div class="col-md-4 text-md-end">
                    {% if is_configured %}
                    <a href="{{ url_for('index', settings=1) }}" id="settings-btn" class="btn btn-outline-light">
                        <i class="fas fa-cog me-2"></i>Settings
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="row">
                        <div class="col-md-12">
                            {% for category, message in messages %}
                                <div class="alert alert-{{ 'success' if category == 'success' else 'danger' if category == 'error' else 'warning' }} alert-dismissible fade show" role="alert">
                                    {{ message|safe }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endwith %}

            <!-- App Status Message -->
            {% if not app_ready %}
                <div class="row">
                    <div class="col-md-12">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            The application is initializing. Some features may not be available yet.
                        </div>
                    </div>
                </div>
            {% endif %}

            <!-- Configuration Form (First-time setup) -->
            {% if not is_configured %}
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="form-container">
                            <h2 class="mb-4">Let's Get Started</h2>
                            <p>Configure your settings to start generating AI-powered newsletters.</p>
                            
                            <form id="config-form" method="post" action="{{ url_for('index') }}">
                                <div class="mb-3">
                                    <label for="tavily_api_key" class="form-label">Tavily API Key</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-key"></i></span>
                                        <input type="password" class="form-control" id="tavily_api_key" name="tavily_api_key" 
                                            placeholder="Enter your Tavily API key" required>
                                        <button class="btn btn-outline-secondary toggle-password" type="button">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div class="form-text">Get your API key from <a href="https://tavily.com" target="_blank">Tavily</a></div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="gemini_api_key" class="form-label">Google Gemini API Key</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-key"></i></span>
                                        <input type="password" class="form-control" id="gemini_api_key" name="gemini_api_key" 
                                            placeholder="Enter your Gemini API key" required>
                                        <button class="btn btn-outline-secondary toggle-password" type="button">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div class="form-text">Get your API key from <a href="https://ai.google.dev/" target="_blank">Google AI Studio</a></div>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="user_email" class="form-label">Your Email Address</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                        <input type="email" class="form-control" id="user_email" name="user_email" 
                                            placeholder="Where should we send your newsletters?" required>
                                    </div>
                                </div>
                                
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary btn-lg" id="save-config-btn" name="setup" value="1">
                                        <i class="fas fa-check-circle me-2"></i>Save Configuration
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- How it works section -->
                <div class="row mt-5">
                    <div class="col-md-12">
                        <h3 class="text-center mb-4">How It Works</h3>
                    </div>
                </div>
                
                <div class="row how-it-works-steps">
                    <div class="col-md-4">
                        <div class="step">
                            <div class="d-flex align-items-center mb-3">
                                <div class="step-number me-3">
                                    <span class="badge">1</span>
                                </div>
                                <h4 class="m-0">Configure</h4>
                            </div>
                            <p>Enter your API keys and email address to get started.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="step">
                            <div class="d-flex align-items-center mb-3">
                                <div class="step-number me-3">
                                    <span class="badge">2</span>
                                </div>
                                <h4 class="m-0">Choose a Topic</h4>
                            </div>
                            <p>Enter any topic you want to receive updates about.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="step">
                            <div class="d-flex align-items-center mb-3">
                                <div class="step-number me-3">
                                    <span class="badge">3</span>
                                </div>
                                <h4 class="m-0">Receive Newsletter</h4>
                            </div>
                            <p>Check your inbox for an AI-generated summary of the latest news.</p>
                        </div>
                    </div>
                </div>
            {% else %}
                <!-- Newsletter Generator Form (After configuration) -->
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="form-container">
                            <h2 class="mb-4">Generate Your Newsletter</h2>
                            <p>Enter a topic to receive a curated newsletter with the latest information.</p>
                            
                            {% if last_topic %}
                                <div class="alert alert-info mb-4">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Your last newsletter was about <strong>{{ last_topic }}</strong>
                                </div>
                            {% endif %}
                            
                            <form id="newsletter-form" method="post" action="{{ url_for('index') }}">
                                <div class="mb-4">
                                    <label for="topic" class="form-label">Newsletter Topic</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-newspaper"></i></span>
                                        <input type="text" class="form-control" id="topic" name="topic" 
                                            placeholder="Enter any topic (e.g., Artificial Intelligence, Climate Change)" required>
                                    </div>
                                </div>
                                
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary btn-lg" id="generateBtn">
                                        <i class="fas fa-paper-plane me-2"></i>Generate & Send Newsletter
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="card mt-4 bg-light">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-lightbulb text-warning me-2"></i>Pro Tips
                                </h5>
                                <ul class="mb-0 ps-3">
                                    <li>Be specific with your topic for more focused results</li>
                                    <li>Try emerging fields for the most recent developments</li>
                                    <li>Use your email address to search for newsletters in your inbox</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </main>

    <!-- Footer Section -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p>&copy; 2025 Newsletter Monitor</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p>Powered by Tavily & Google Gemini</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>